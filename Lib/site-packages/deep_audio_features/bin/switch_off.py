from tuya_connector import (
	TuyaOpenAPI,    
	TuyaOpenPulsar,
	TuyaCloudPulsarTopic,
)

#ts = time.time()

# Initiate connection to Tuya device
ACCESS_ID = "<access_id>"
ACCESS_KEY = "<access_key>"
API_ENDPOINT = "https://openapi.tuyaus.com"
MQ_ENDPOINT = "wss://mqe.tuyaus.com:8285/"

DEVICE_ID ="<device_id>"

BULB_MODEL_NAME = "<rgb_model_name>"


# Init OpenAPI and connect
openapi = TuyaOpenAPI(API_ENDPOINT, ACCESS_ID, ACCESS_KEY)
openapi.connect()   

DEVICE_ID ="eb1aeabb37c62584f7ke0s"

response = openapi.get('/v1.0/iot-03/devices/{}/status'.format(DEVICE_ID))
status = next((item for item in response['result'] if item["code"] == "switch_led"), None)
if status is not None:
    switch_led_status = status['value']    
    if (switch_led_status) == False:
        print("Smart bulb with model name: ", BULB_MODEL_NAME, " was already turned off.")                
    elif (switch_led_status) == True:
        #print("Turning the LED light to OFF, device id: ", DEVICE_ID, ", model name: ", BULB_MODEL_NAME)
        turn_on = {'commands': [{'code': 'switch_led', 'value': False}]}
        openapi.post('/v1.0/iot-03/devices/{}/commands'.format(DEVICE_ID), turn_on)
        print("Turned Off")
    else:
        print("Unknown status: ", switch_led_status)
else:
    print("switch_led not found in the device status")
